# malrob/paths.py
from __future__ import annotations
from dataclasses import dataclass
from pathlib import Path

@dataclass(frozen=True)
class RunPaths:
    repo_root: Path
    dataset_tag: str                 # e.g. "12k", "50k"
    model_dir: Path                 # e.g. repo_root / f"models_full_{dataset_tag}"
    artifacts_dir: Path             # model_dir / "artifacts"
    results_adv_dir: Path           # model_dir / "results_adv"
    artifacts_adv_dir: Path         # model_dir / "artifacts_adv"
    plots_dir: Path                 # results_adv_dir / "plots"

def make_run_paths(repo_root: Path, dataset_tag: str) -> RunPaths:
    model_dir = repo_root / f"models_full_{dataset_tag}"
    return RunPaths(
        repo_root=repo_root,
        dataset_tag=dataset_tag,
        model_dir=model_dir,
        artifacts_dir=model_dir / "artifacts",
        results_adv_dir=model_dir / "results_adv",
        artifacts_adv_dir=model_dir / "artifacts_adv",
        plots_dir=(model_dir / "results_adv" / "plots"),
    )

def ensure_dirs(p: RunPaths) -> None:
    p.model_dir.mkdir(parents=True, exist_ok=True)
    p.artifacts_dir.mkdir(parents=True, exist_ok=True)
    p.results_adv_dir.mkdir(parents=True, exist_ok=True)
    p.artifacts_adv_dir.mkdir(parents=True, exist_ok=True)
    p.plots_dir.mkdir(parents=True, exist_ok=True)
